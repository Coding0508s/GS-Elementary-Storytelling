# AI 일괄 채점 시스템 사용법

## 개요
관리자 페이지에서 모든 제출 영상을 AI Whisper와 GPT-4를 사용하여 자동으로 채점하는 기능입니다.

## 기능
- **일괄 AI 채점**: 모든 제출 영상을 한번에 AI로 채점
- **실시간 진행상황**: 채점 진행률과 상태를 실시간으로 확인
- **실패 재시도**: 실패한 채점을 다시 시도
- **백그라운드 처리**: 큐 시스템을 사용한 비동기 처리

## 처리 과정
1. **영상 → 음성 추출**: FFmpeg를 사용하여 영상에서 오디오 추출
2. **음성 → 텍스트**: OpenAI Whisper API로 음성을 텍스트로 변환
3. **텍스트 → 평가**: GPT-4로 영어 발표 평가 (발음, 어휘, 유창성)
4. **점수 저장**: 데이터베이스에 평가 결과 저장

## 사용 방법

### 1. 큐 워커 시작
```bash
# 큐 워커 시작 (백그라운드에서 실행)
./start-queue-worker.sh

# 상태 확인
ps aux | grep 'queue:work'

# 워커 중지
./stop-queue-worker.sh
```

### 2. 관리자 페이지에서 사용
1. 관리자로 로그인
2. 대시보드의 "AI 일괄 채점" 섹션으로 이동
3. "일괄 AI 채점 시작" 버튼 클릭
4. 진행상황을 실시간으로 확인

### 3. 기능 설명

#### 일괄 AI 채점 시작
- 모든 제출 영상에 대해 AI 채점을 시작
- 이미 완료된 영상은 건너뜀
- 처리 중인 영상은 중복 처리하지 않음

#### 실시간 진행상황
- **완료**: AI 채점이 완료된 영상 수
- **처리중**: 현재 AI 채점이 진행 중인 영상 수
- **실패**: AI 채점이 실패한 영상 수
- **대기**: 아직 처리되지 않은 영상 수

#### 실패한 평가 재시도
- 실패한 AI 채점을 다시 시도
- 네트워크 오류나 일시적 문제로 실패한 경우 유용

## 기술적 세부사항

### 큐 시스템
- Laravel Queue를 사용한 백그라운드 처리
- 데이터베이스 드라이버 사용
- 각 영상은 별도의 Job으로 처리

### AI 평가 기준
- **발음 및 억양 (10점)**: 정확한 발음과 자연스러운 억양
- **어휘 및 표현 (10점)**: 올바른 어휘와 표현 사용
- **유창성 (10점)**: 말의 흐름과 유창성

### 에러 처리
- 각 단계별 에러 로깅
- 실패한 작업은 재시도 가능
- 상세한 에러 메시지 제공

## 주의사항

### 성능 고려사항
- 대용량 영상 처리 시 시간이 오래 걸릴 수 있음
- OpenAI API 사용량에 따른 비용 발생
- 서버 리소스 사용량 모니터링 필요

### 보안 고려사항
- OpenAI API 키 보안 관리
- 영상 파일 접근 권한 확인
- 관리자 권한 검증

### 모니터링
- 큐 워커 상태 확인
- 로그 파일 모니터링 (`storage/logs/queue-worker.log`)
- 데이터베이스 큐 테이블 확인

## 문제 해결

### 큐 워커가 작동하지 않는 경우
```bash
# 큐 워커 상태 확인
ps aux | grep 'queue:work'

# 수동으로 큐 워커 시작
php artisan queue:work --verbose

# 큐 테이블 확인
php artisan tinker
>>> DB::table('jobs')->count()
```

### AI 채점이 실패하는 경우
1. OpenAI API 키 확인
2. 영상 파일 접근 가능 여부 확인
3. FFmpeg 설치 여부 확인
4. 로그 파일 확인 (`storage/logs/laravel.log`)

### 메모리 부족 오류
```bash
# PHP 메모리 제한 증가
php -d memory_limit=2G artisan queue:work
```

## 로그 파일 위치
- **큐 워커 로그**: `storage/logs/queue-worker.log`
- **애플리케이션 로그**: `storage/logs/laravel.log`
- **AI 평가 로그**: `storage/logs/laravel.log` (AI 관련 로그 포함)
